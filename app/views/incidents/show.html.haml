- model_class = Incident
.page-header
  %h1= "Incident ID #{@incident.short_name} Details"

%p.lead
  Report filed
  - if @incident.user.present?
    by
    = link_to byuser_sorted_incidents_path('latest', @incident.user.id) do
      %img.img-rounded{ src: @incident.user.gravatar(32) }
      = @incident.user.name
  - else
    %span.muted anonymously

%p
  %strong Report Legitimacy Score
  %a{href: '#', rel: 'scorepopover', data: {title: 'What is a legitimacy score?', content: "<p><strong>Doored.ca</strong> is a <em>crowdsourced</em> stats database with all of its data entered by users. As a result, many reports could be fraudulent or misrepresented.</p><p>A <strong>legitimacy or reliability score</strong> exists to automatically determine which data points are most likely to be accurate.</p><p>An admin or moderator, at a later time, may manually verify the details of a report and set a score override.</p>".html_safe}}
    %i.icon-question-sign
  %br
  - if @incident.score_override.present?
    .text-success
      %i.icon-ok
      This report has been manually verified by site volunteers and has been assigned a legitimacy score of
      %strong= @incident.score_percent
  - else
    This report has scored
    %strong= @incident.score
    points. Yielding a reliability of
    %strong= @incident.score_percent

%p
  %strong= model_class.human_attribute_name(:description) + ':'
  %br
  = @incident.description
%p
  %strong= model_class.human_attribute_name(:datetime_of_incident) + ':'
  %br
  = @incident.datetime_of_incident
  %span.muted= "(#{time_ago_in_words @incident.datetime_of_incident, include_seconds: true} ago)"
%p
  %strong= model_class.human_attribute_name(:location) + ':'
  %br
  = @incident.location
%p
  %strong= model_class.human_attribute_name(:severity) + ':'
  %br
  %span{style: "color: #{@incident.severity_color}"}= @incident.severity_text
  %span.muted= "(Level #{@incident.severity})"
%p
  %strong= model_class.human_attribute_name(:police_report_number) + ':'
  %br
  = @incident.police_report_number
%p
  %strong= model_class.human_attribute_name(:video) + ':'
  %br
  = @incident.video

- if @incident.car.present?
  %p
    %strong Associated Vehicle:
    %br
    = link_to @incident.car, car_path(@incident.car)

%p
  %strong Witnesses:
  %br
  - if @incident.witnesses.count == 0
    %span.muted (None)
  - else
    %ol
      - @incident.witnesses.each do |witness|
        %li
          - if witness.private?
            %i.icon-lock
            = witness
            %a{ href: '#', rel: 'tooltip' , title: 'witness details withheld for privacy their privacy' } why?
          - else
            = link_to witness, witness_path(witness)

.form-actions
  = link_to t('.back', :default => t("helpers.links.back")), incidents_path, :class => 'btn'
  - if @incident.user.present? && @incident.user == current_user
    = link_to t('.edit', :default => t("helpers.links.edit")), edit_incident_path(@incident), :class => 'btn'
    = link_to t('.destroy', :default => t("helpers.links.destroy")), incident_path(@incident), :method => "delete", :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) }, :class => 'btn btn-danger'
